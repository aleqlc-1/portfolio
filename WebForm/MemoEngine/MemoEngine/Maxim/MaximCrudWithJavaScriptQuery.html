<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>jQuery와 ASP.NET Web API를 사용한 CRUD 구현하기</title>
    <script src="/Scripts/jquery-3.4.1.min.js"></script>
    <script type="text/javascript">
        //Web API 주소
        var API_URL = "/api/maximservice/";

        //상태 클리어
        function clearStatus() {
            $("#lblError").html('');
        }
        function clearField() {
            $("#name").val('');
            $("#content").val('');
        }

        //데이터 조회 전용 함수
        function displayData() {
            $('#lstMaxims').html('');
            //전체 명언 리스트를 읽어서 출력
            $.getJSON(API_URL, function (data) {
                //console.log(data.length); //데이터의 개수
                $.each(data, function (key, val) {
                    var str = val.id + ", " + val.name + ", " + val.content;
                    $("<li />", { html: str }).appendTo("#lstMaxims");
                });
            });
        }

        //Page_Load
        $(function () {
            //전체 레코드 출력
            displayData();

            //Create
            $("#btnAdd").click(function () {
                clearStatus();
                //데이터 받기
                var name = $('#name').val();
                var content = $('#content').val();
                //JSON 개체로 묶기 : " + 변수 + "
                var json =
                    "{name:\"" + name + "\", content:\"" + content + "\"}";
                //전송
                $.ajax({
                    url: API_URL,
                    cache: false,
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    data: json,
                    statusCode: {
                        201: function (data) {
                            var str = data.id + ", " + data.name
                                + ", " + data.content;
                            $("<li />", { html: str }).appendTo("#lstMaxims");
                        }
                    }
                });
                clearField();
            });

            //Retrieve(조회)
            $("#btnFind").click(function () {
                clearStatus();
                clearField();
                // id값 가져오기
                var id = $("#id").val();
                //특정 번호에 해당하는 명언 정보를 읽어서 출력
                $.getJSON(API_URL + id, function (data) {
                    $("#name").val(data.name);
                    $("#content").val(data.content);
                }).fail(function (xhr, sts, err) {
                    $("#lblError").html("에러 : " + err);
                });
            });

            //PUT
            
        });
    </script>
</head>
<body>

</body>
</html>